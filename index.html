<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
  <meta charset="UTF-8">
  <meta author="Zakaria Moumen">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="1337 Champions Wall of Fame">
  <link rel="icon" href="imgs/1337.png" type="image/png">
  <title>1337 Champions Wall of Fame</title>
  <link rel="icon" href="imgs/1337.png" type="image/png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <nav class="navbar bg-body-tertiary">
    <div class="container">
      <a class="navbar-brand" href="#">
        <img src="imgs/1337.png" alt="1337" width="50" height="50">
      </a>
    </div>
  </nav>
  <div class="black-screen-of-bad-UX flex-column">
    <img src="imgs/flip_phone.gif" width="80" height="80">
    <p class="text-center px-4">
      Too much to give.<br>
      Find a bigger screen to get a full experience<br>
    </p>
  </div>
  <div class="container-xl" style="min-height: 100vh;">
    <div style="height: 600px;" class="text-center">
        <!-- disclaimer alert -->
        <p class="text-center alert alert-warning alert-dismissible fade show mt-2" role="alert">
          <strong>Disclaimer:</strong> Data is updated every 15 minutes and doesn't reflect the real-time leaderboard.
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </p >
      <h1 class="display-3 pt-5">
        Codingame 2024 Summer Challenge
      </h1>
      <!-- <h5> 
        1337 Champions Wall of Fame
      </h5> -->
      <div style="width: 100%; height:350px;"
        class="d-flex flex-row gap-2 gap-sm-5 justify-content-center align-items-center">
        <div id="leaderboard-5" class="position-relative d-flex flex-column justify-content-center align-items-center"
          style="top:50px">
          <p class="display-5 top-5" onclick="toggle_school_global_rank(this)" data-rank-swap="5"><span class="rank">5</span><sup class="ordinal" style="font-size:12pt">th</sup></p>
          <div class="position-relative">
            <img src="imgs/1337.png" class="intra-image">
            <img src="imgs/1337.png" class="mini-image" style="right:-10%;bottom:0">
            <img src="imgs/legend.png" class="mini-image" style="left:-10%;bottom:0">
          </div>
          <p class="m-0">Future...</p>
          <p class="m-0">Is Loading</p>
          <p class="text-muted m-0">MED</p>
        </div>
        <div id="leaderboard-3" class="position-relative d-flex flex-column justify-content-center align-items-center"
        style="top:0px">
        <p class="display-5 top-5" onclick="toggle_school_global_rank(this)" data-rank-swap="3"><span class="rank">3</span><sup class="ordinal" style="font-size:12pt">rd</sup></p>
        <div class="position-relative">
          <img src="imgs/1337.png" class="intra-image">
          <img src="imgs/1337.png" class="mini-image" style="right:-10%;bottom:0">
          <img src="imgs/legend.png" class="mini-image" style="left:-10%;bottom:0">
        </div>
        <p class="m-0">Future...</p>
        <p class="m-0">Is Loading</p>
        <p class="text-muted m-0">MED</p>
      </div>
      <div id="leaderboard-1" class="position-relative d-flex flex-column justify-content-center align-items-center"
          style="top:-50px">
          <p class="display-5 top-5" onclick="toggle_school_global_rank(this)" data-rank-swap="1"><span class="rank">1</span><sup class="ordinal" style="font-size:12pt">st</sup></p>
          <div class="position-relative">
            <img src="imgs/1337.png" class="intra-image">
            <img src="imgs/1337.png" class="mini-image" style="right:-10%;bottom:0">
            <img src="imgs/legend.png" class="mini-image" style="left:-10%;bottom:0">
          </div>
          <p class="m-0">Future...</p>
          <p class="m-0">Is Loading</p>
          <p class="text-muted m-0">MED</p>
        </div>
        <div id="leaderboard-2" class="position-relative d-flex flex-column justify-content-center align-items-center"
          style="top:0px">
          <p class="display-5 top-5" onclick="toggle_school_global_rank(this)" data-rank-swap="2"><span class="rank">2</span><sup class="ordinal" style="font-size:12pt">nd</sup></p>
          <div class="position-relative">
            <img src="imgs/1337.png" class="intra-image">
            <img src="imgs/1337.png" class="mini-image" style="right:-10%;bottom:0">
            <img src="imgs/legend.png" class="mini-image" style="left:-10%;bottom:0">
          </div>
          <p class="m-0">Future...</p>
          <p class="m-0">Is Loading</p>
          <p class="text-muted m-0">MED</p>
        </div>
        <div id="leaderboard-4" class="position-relative d-flex flex-column justify-content-center align-items-center"
          style="top:50px">
          <p class="display-5 top-5" onclick="toggle_school_global_rank(this)" data-rank-swap="4"><span class="rank">4</span><sup class="ordinal" style="font-size:12pt">th</sup></p>
          <div class="position-relative">
            <img src="imgs/1337.png" class="intra-image">
            <img src="imgs/1337.png" class="mini-image" style="right:-10%;bottom:0">
            <img src="imgs/legend.png" class="mini-image" style="left:-10%;bottom:0">
          </div>
          <p class="m-0">Future...</p>
          <p class="m-0">Is Loading</p>
          <p class="text-muted m-0">MED</p>
        </div>
      </div>
    </div>
    <div class="d-block">
      <table id="leaderboard" class="table text-center" style="vertical-align: middle;">
        <thead>
          <tr>
            <th scope="col"></th>
            <th scope="col3" style="text-align: left !important;">Champion</th>
            <th scope="col"></th>
            <th scope="col">Global Rank</th>
            <th scope="col" colspan="2">School Rank</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="position-relative" style="width: 0;">
              <img src="imgs/1337.png" class="intra-image">
              <img src="imgs/1337.png" class="mini-image">
            </td>
            <td style="text-align: left !important; ">
              <h5 class="m-0">Future</h5>
              <p class="m-0">is loading...</p>
            </td>
            <td>Legend</td>
            <td>1</td>
            <td>1</td>
            <td>MED</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <footer class="footer mt-auto py-3 bg-body-tertiary bottom-0 w-100">
    <div class="container text-center">
      <span class="text-muted">Made with ❤️ by <a href="https://www.linkedin.com/in/zakaria-moumen"
          class="text-decoration-none">Zakaria Moumen</a>
      </span>
    </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>

    function populate_table(data) {
      let table = document.getElementById("leaderboard");
      // remove current body
      table.removeChild(table.getElementsByTagName("tbody")[0]);
      let tbody = document.createElement("tbody");
      for (let i = 0; i < 5; i++) {
        let box = document.getElementById("leaderboard-" + (i + 1))
        box.setAttribute("onclick", "click_info_delayer('" + data[i].intra_login + "')");
        // append cursor pointer to styles
        // box.setAttribute("style", box.getAttribute("style") + ";cursor:pointer");
        box.getElementsByTagName("p")[0].setAttribute("data-rank-swap", data[i].global_rank);
        box.getElementsByClassName("intra-image")[0].setAttribute("src", data[i].intra_avatar);
        box.getElementsByClassName("mini-image")[0].setAttribute("src", data[i].cg_avatar);
        box.getElementsByClassName("mini-image")[1].setAttribute("src", "imgs/" + data[i].league.split("_")[0].toLowerCase() + ".png");

        box.getElementsByTagName("p")[1].innerHTML = data[i].intra_login;
        box.getElementsByTagName("p")[2].innerHTML = data[i].cg_username;
        box.getElementsByTagName("p")[3].innerHTML = data[i].intra_campus;
      }

      for (let i = 0; i < data.length; i++) {
        let user = data[i];
        let row = document.createElement("tr");
        let images = document.createElement("td");
        let login = document.createElement("td");
        let league = document.createElement("td");
        let campuse = document.createElement("td");
        let schoolrank = document.createElement("td");
        let global_rank = document.createElement("td");

        images.setAttribute("class", "position-relative");
        images.setAttribute("style", "width: 0");
        let intraimg = document.createElement("img");
        intraimg.setAttribute("src", user.intra_avatar);
        intraimg.setAttribute("class", "intra-image table-image");

        images.appendChild(intraimg);
        miniimage = document.createElement("img");
        miniimage.setAttribute("src", user.cg_avatar);
        miniimage.setAttribute("class", "mini-image table-image");
        images.appendChild(miniimage);

        let login_intra = document.createElement("h6");
        login_intra.setAttribute("class", "m-0");
        login_intra.innerHTML = user.intra_login;
        let login_codingame = document.createElement("p");
        login.setAttribute("style", "text-align: left !important;");
        login_codingame.setAttribute("class", "m-0");
        login_codingame.innerHTML = user.cg_username;
        login.appendChild(login_intra);
        login.appendChild(login_codingame);

        let _league_img = document.createElement("img");
        _league_img.setAttribute("style", "width: 30px;");
        _league_img.setAttribute("src", "imgs/" + user.league.split("_")[0].toLowerCase() + ".png");
        league.appendChild(_league_img);
        league.setAttribute("style", "border: none;width: 0;");
        campuse.innerHTML = user.intra_campus;
        schoolrank.innerHTML = user.school_rank;
        global_rank.innerHTML = user.global_rank;
        row.appendChild(league);
        row.appendChild(images);
        row.appendChild(login);
        // set row on click to redirect to profile
        row.appendChild(global_rank);
        row.appendChild(schoolrank);
        row.appendChild(campuse);
        row.setAttribute("onclick", "click_info_delayer('" + user.intra_login + "')");
        tbody.appendChild(row);
        table.appendChild(tbody);
      }
    }

    function get_ordinal(n){
      let s = ["th", "st", "nd", "rd"],
      v = n % 100;
      return (s[(v - 20) % 10] || s[v] || s[0]);
    }

    function toggle_school_global_rank(elem){
      // flip the ranks for the top 5

      let ranks = document.querySelectorAll("[data-rank-swap]");
      ranks.forEach(rank => {
        let current = rank.getElementsByClassName("rank")[0].innerHTML;
        let swap = rank.getAttribute("data-rank-swap");
        rank.getElementsByClassName("rank")[0].innerHTML = swap;
        rank.getElementsByClassName("ordinal")[0].innerHTML = get_ordinal(swap);
        rank.setAttribute("data-rank-swap", current);
      });
    }

    function fetch_leaderboard() {
      fetch("data.json")
        .then(response => response.json())
        .then(data => populate_table(data))
        .catch(error => console.log(error));
    }

    fetch_leaderboard();

    var delayer_click_info = {
      "intra_login": "",
      "counter": 0
    }
    function click_info_delayer(intra_login){
      const TARGET_COUNTER = 3;
      if(delayer_click_info.intra_login == intra_login){
        delayer_click_info.counter++;
        if(delayer_click_info.counter == TARGET_COUNTER){
          window.location.href = "info.html?login=" + intra_login;
        }
      }else{
        delayer_click_info.intra_login = intra_login;
        delayer_click_info.counter = 1;
      }
    }
  </script>
</body>

</html>